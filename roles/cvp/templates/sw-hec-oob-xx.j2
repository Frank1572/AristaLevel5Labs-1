{# this is to have to macros available that are used for switch port generation #}
{% import "templates/libs.j2" as funcs with context%}
hostname sw-hec{{ hec.hec_nr }}-oob-{{ item.number}}
!
snmp-server contact {{ item.snmp.contact}}
snmp-server location {{ item.snmp.location}}
!
{% if hec.is_tacacs %}
ip tacacs source-interface Vlan21
{% else %}
ip radius source-interface Vlan21
{% endif %}
!
logging source-interface Vlan21
!
{{eos_cmd.c_ntp_source}} Vlan21
!
{% if item.typ is defined and item.type == 'core' %}
mlag configuration
   domain-id MLAG-oob
!
vlan 4094
   name MLAG_Vlan
!
spanning-tree mst 0-1 priority 28672
!
alias dhcp-off
   10 bash sudo service dhcpd stop
   20 bash sudo service dhcpd status
!
alias dhcp-on
   10 bash sudo cp /mnt/flash/dhcpd.conf /etc/dhcp/
   20 bash sudo service dhcpd start
   30 bash sudo service dhcpd status
!
alias dhcp-status
   10 bash sudo service dhcpd status
   20 bash sudo cat /var/lib/dhcpd/dhcpd.leases
!
{% endif %}{# end of oob-core specific settings #}
!
{# setting all ports to default access-port with oob vlan 21 #}
interface Ethernet1-46
   switchport access vlan 21
!
{% if item.ports is defined %}
{% for port in item.ports %}
{{ funcs.switchport(port) }}
{% endfor %}
{% endif %}{# end of port generation #}
{% if item.port_channels is defined %}
{% for po in item.port_channels %}
{{ funcs.switchportchannels(po) }}
{% endfor %}
{% endif %}{# end of port-channel generation #}
!
! === Uplinks to the cental OOB Pair (oob01[ab])
interface Port-Channel1
   switchport trunk allowed vlan 21
   switchport mode trunk
   port-channel lacp fallback individual
!
interface Ethernet47
   switchport trunk allowed vlan 21
   switchport mode trunk
   channel-group 1 mode active
!
interface Ethernet48
   switchport trunk allowed vlan 21
   switchport mode trunk
   channel-group 1 mode active
!
!interface Vlan21
!   ip address {{ hec.oob_prefix }}.{{ item.ip_last_octett}}/{{ hec.oob_mask }}
!
{% if item.type != 'core' %}
ip route 0.0.0.0/0 {{ hec.oob_def_gw }}
!
{% endif %}
