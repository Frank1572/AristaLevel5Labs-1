! Start: Remove config not needed for NGDR 
!
no spanning-tree mst 0-1 priority 28672
no route-map MLPEER-RM permit 10 
no route-map MLPEER-RM permit 20
no ip prefix-list ANY-PL seq 10 permit 0.0.0.0/0 le 32 
no interface Loopback2 
no vlan internal order descending range 3100 3999
! 
! End: Remove config not needed for NGDR 
!
!
route-map RM-MAINT permit 10
   set as-path prepend auto auto auto auto 
!
alias drain
   10 configure
   20 maintenance
   30 unit System
   40 quiesce
   50 router bgp 64103.10999
   60 neighbor PG-EDGE-ROUTER route-map RM-MAINT out
   70 end
!
alias undrain
   10 configure
   20 router bgp 64103.10999
   30 no neighbor PG-EDGE-ROUTER route-map RM-MAINT out
   40 no maintenance
   50 end
!
event-monitor 
!
vlan 30
   name HANA-STOR01
!
vlan 900 
   name NW-MGMT 
! 
vlan 922 
   name BACKUP-TRANS 
!
vrf instance INFRA 
   description InfraVRF 
!
bfd multihop interval 1000 min_rx 1000 multiplier 3 
!
interface Ethernet 1/1,2/1,3/1,4/1,5/1,6/1,7/1,8/1,9/1,10/1,11/1,12/1,13/1,14/1,15/1,16/1,17/1,18/1,19/1,20/1,21/1,22/1,23/1,24/1,25/1
   shutdown
   no switchport
!
interface Ethernet26/1
   speed forced 100gfull
 
 
   mtu 9100
 
   no switchport
 
 
 
 
   bfd interval 1000 min_rx 1000 multiplier 3  
 
interface Vlan922
 
 
   mtu 9100
 
 
 
   no autostate
 
 
   vrf INFRA  
 
   ip virtual-router address 10.255.176.94
 
 
  
! 
! ===== Spine Uplinks =====
interface Ethernet27/1
   no switchport
   description SPINE UPLINK
   mtu 9214
   speed forced 100gfull
!
interface Ethernet28/1
   no switchport
   description SPINE UPLINK
   mtu 9214
   speed forced 100gfull
!
interface Ethernet29/1
   no switchport
   description SPINE UPLINK
   mtu 9214
   speed forced 100gfull
!
interface Ethernet30/1
   no switchport
   description SPINE UPLINK
   mtu 9214
   speed forced 100gfull
!
!
interface Loopback1 
   description Router-ID and VTEP
!
interface Loopback900 
   description NW-MGMT
! 
interface Management1 
   vrf OOB  
! 
interface Vxlan1 
   vxlan source-interface Loopback1 
   vxlan vlan 922 vni 10922   
   vxlan vrf INFRA vni 9030000
!
hardware tcam 
   system profile vxlan-routing   
!
ip virtual-router mac-address 00:1c:73:00:00:98 
!
ip routing vrf INFRA 
!
ip route vrf INFRA 100.68.0.0/15 Vlan922 10.255.176.81
ip route vrf INFRA 198.19.227.0/26 Vlan922 10.255.176.81
ip route vrf INFRA 198.19.227.64/26 Vlan922 10.255.176.81
!
ip prefix-list PL-EDGE seq 10 permit 198.19.249.0/24 eq 32 
ip prefix-list PL-EDGE seq 20 permit 198.19.251.0/24 eq 32 
ip prefix-list PL-FORBIDDEN-PREF seq 10 permit 10.0.0.0/8 le 32 
ip extcommunity-list FILTER_LOCAL_MAC permit rt 1:1 
!
route-map RM-EDGE permit 10 
   match ip address prefix-list PL-EDGE 
! 
route-map RM-HAPEER deny 10 
   match ip address prefix-list PL-FORBIDDEN-PREF 
! 
route-map RM-HAPEER deny 15 
   match extcommunity FILTER_LOCAL_MAC 
! 
route-map RM-HAPEER permit 20 
! 
router bgp 64103.10999 
   bgp asn notation asdot 
   no bgp default ipv4-unicast 
   distance bgp 20 95 200 
   maximum-paths 8 ecmp 16 
   neighbor PG-EDGE-ROUTER peer group 
   neighbor PG-EDGE-ROUTER remote-as 65199
   neighbor PG-EDGE-ROUTER next-hop-unchanged 
   neighbor PG-EDGE-ROUTER update-source Loopback1 
   neighbor PG-EDGE-ROUTER bfd 
   neighbor PG-EDGE-ROUTER rib-in pre-policy retain all 
   neighbor PG-EDGE-ROUTER ebgp-multihop 
   neighbor PG-EDGE-ROUTER send-community standard extended 
   neighbor PG-EDGE-ROUTER maximum-routes 0 
   neighbor PG-HA-ROUTER peer group 
   neighbor PG-HA-ROUTER remote-as 64103.10999 
   neighbor PG-HA-ROUTER update-source Loopback1 
   neighbor PG-HA-ROUTER bfd 
   neighbor PG-HA-ROUTER rib-in pre-policy retain all 
   neighbor PG-HA-ROUTER send-community standard extended 
   neighbor PG-HA-ROUTER maximum-routes 0 
   neighbor PG-RMT-HA-ROUTER peer group
   neighbor PG-RMT-HA-ROUTER remote-as 64116.10999 
   neighbor PG-RMT-HA-ROUTER next-hop-unchanged 
   neighbor PG-RMT-HA-ROUTER bfd 
   neighbor PG-RMT-HA-ROUTER rib-in pre-policy retain all 
   neighbor PG-RMT-HA-ROUTER route-map RM-HAPEER out 
   neighbor PG-RMT-HA-ROUTER send-community standard extended 
   neighbor PG-RMT-HA-ROUTER maximum-routes 0 
   neighbor PG-SPINE peer group
   neighbor PG-SPINE remote-as 64103.10000 
   neighbor PG-SPINE allowas-in 3 
   neighbor PG-SPINE rib-in pre-policy retain all 
   neighbor PG-SPINE send-community 
   neighbor PG-SPINE maximum-routes 0
 
   neighbor PG-SPINE-EVPN peer group 
   neighbor PG-SPINE-EVPN remote-as 64103.10000 
   neighbor PG-SPINE-EVPN update-source Loopback1 
   neighbor PG-SPINE-EVPN bfd 
   neighbor PG-SPINE-EVPN rib-in pre-policy retain all 
   neighbor PG-SPINE-EVPN ebgp-multihop 2 
   neighbor PG-SPINE-EVPN send-community standard extended 
   neighbor PG-SPINE-EVPN maximum-routes 0 
   neighbor 10.100.0.11 peer group PG-SPINE-EVPN 
   neighbor 10.100.0.12 peer group PG-SPINE-EVPN 
   neighbor 10.100.0.13 peer group PG-SPINE-EVPN 
   neighbor 10.100.0.14 peer group PG-SPINE-EVPN 
   neighbor 198.19.249.112 peer group PG-EDGE-ROUTER
   neighbor 198.19.249.112 description *** BGP to rt-hec03-cwan-02a ***
   neighbor 198.19.249.113 peer group PG-EDGE-ROUTER
   neighbor 198.19.249.113 description *** BGP to rt-hec03-cwan-02b ***
   neighbor 198.19.251.64 peer group PG-EDGE-ROUTER
   neighbor 198.19.251.64 description *** BGP to rt-hec03-cwan-01a ***
   neighbor 198.19.251.65 peer group PG-EDGE-ROUTER
   neighbor 198.19.251.65 description *** BGP to rt-hec03-cwan-01b ***
   neighbor 198.19.251.66 peer group PG-EDGE-ROUTER
   neighbor 198.19.251.66 description *** BGP to rt-hec03-vpn-01a ***
   neighbor 198.19.251.67 peer group PG-EDGE-ROUTER
   neighbor 198.19.251.67 description *** BGP to rt-hec03-vpn-01b ***
   neighbor 198.19.251.68 peer group PG-EDGE-ROUTER
   neighbor 198.19.251.68 description *** BGP to rt-hec03-idc-01a ***
   neighbor 198.19.251.69 peer group PG-EDGE-ROUTER
   neighbor 198.19.251.69 description *** BGP to rt-hec03-idc-01b ***
   ! 
 
   vlan-aware-bundle all-vlans 
      route-target both 1:1 
      redistribute learned 
      vlan 5-2999 
   ! 
   address-family evpn 
 
      neighbor PG-SPINE-EVPN activate
      neighbor 198.19.249.112 activate
      neighbor 198.19.249.113 activate
      neighbor 198.19.251.64 activate
      neighbor 198.19.251.65 activate
      neighbor 198.19.251.66 activate
      neighbor 198.19.251.67 activate
      neighbor 198.19.251.68 activate
      neighbor 198.19.251.69 activate
 
   ! 
   address-family ipv4 
 
      no neighbor PG-SPINE-EVPN activate 
   ! 
   vrf INFRA 
      rd 03:900 
      route-target import evpn 16:900 
      route-target export evpn 03:900 
      redistribute static 
! 
