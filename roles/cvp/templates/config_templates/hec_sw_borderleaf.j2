#jinja2: trim_blocks: "true", lstrip_blocks: "true"
{# hec_sw_borderleaf.j2 #}
{% set leafid = id | regex_replace('^.*(?P<a_or_b>[ab])$', '\\g<a_or_b>') %}
{% set brdrtype = id | regex_replace('^(?P<one_or_two>[12])[ab]$', '\\g<one_or_two>') %}
{% if brdrtype == 2 %}
vlan 914
   name FW-CORE-TRANS
vlan 915
   name FWT-CORE-TRANS
vlan 916
   name FW-BRDR-TRANS
interface Vxlan1
  vxlan vlan 914 vni 10914
  vxlan vlan 916 vni 10916
{% endif %}
{% if brdrtype == 3 %}
vlan 900
   name NW-MGMT
vlan 920
   name RT-TRANS
interface Vxlan1
  vxlan vlan 920 vni 10920
{% endif %}
!leafid {{ leafid }}
{% for allbrdrs in hec.brdr %}
!allbrdrs.number {{allbrdrs.number}}
  {% if allbrdrs.number|string == id %}

    {% for item in allbrdrs.uplinks %}
    ! ===== Spine Uplinks =====
    interface Ethernet{{ item }}
       no switchport
       description SPINE UPLINK
       mtu {{ hec.fabric.interlink_mtu }}
    !
    {% endfor %}
    {% for item in allbrdrs.ports %}
      {% if item.type is defined %}
        {% if item.type != "Ethernet" %}
          {% if item.type == 'vlan' %}
            {% set inttype = 'Vlan' %}
          {% endif %}
          {% if item.type == 'spine_link' %}
            {% set inttype = 'Ethernet' %}
          {% endif %}
          interface {{ inttype }}{{ item.id }}
        {% endif %}
      {% endif %}
      {% if item.type is not defined %}
        interface Ethernet{{ item.id }}
      {% endif %}
        description ->{{ item.description }}
      {% if item.po is defined %}
        channel-group {{ item.po }} mode active
      {% endif %}
      {% if item.ip is defined %}
        {% if item.type is defined %}
          {% if item.type != "vlan" %}
            no switchport
          {% endif %}
          {% if item.type == "spine_link" %}
            mtu {{ hec.fabric.interlink_mtu }}
          {% endif %}
        {% endif %}
        ip address {{ item.ip }}
      {% endif %}
    {% endfor %}
    {% if allbrdrs.port_channels is defined %}
    {% for po in allbrdrs.port_channels %}
      interface Port-Channel{{ po.id }}
      {% if po.id == 42 %}
        description {{ po.description }}
        switchport mode trunk
        switchport trunk group MLAG-Peer
      {% else %}
        description {{ po.description }}
        mlag {{ po.id }}
        {% if po.trunk is defined %}
          switchport mode trunk
          {% if po.trunk != "all" %}
            switchport trunk allowed vlan {{ po.trunk }}
          {% endif %}
        {% endif %}
        {% if po.access_vlan is defined %}
          switchport access vlan {{ po.access_vlan }}
        {% endif %}
      {% endif %}
    {% endfor %}
    {% endif %}
  {% endif %}
{% endfor %}

{% include "templates/config_templates/hec_sw_leaf_routing_configuration.j2" %}
