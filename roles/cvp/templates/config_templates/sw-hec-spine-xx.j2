{#
  Fixed models use Management1 while chassis-based models have Management0 for OOB connectivity
#}
{% set oob_mgmt_intf = "Management0" %}
{% if hec.spine.model|string is search('7280.*') %}
{% set oob_mgmt_intf = "Management1" %}
{% endif %}
{% set ports_per_lc = 36 %}
hostname sw-hec{{ hec.hec_nr }}-spine-{{ item.id }}
!
snmp-server contact {{ item.snmp.contact }}
snmp-server location {{ item.snmp.location }}
!
{% for a in hec.spine.number %}
{% if a.id == item %}
snmp-server contact {{a.snmp.contact}}
snmp-server location {{a.snmp.location}}
!
{% endif %}
{% endfor %}
{% if hec.spine.model|string is search('75[01][486].*')  %}
{% set lc_start = 3 %}
{% set lc_end   = lc_start + hec.spine.linecards %}
{% endif %}
{% if hec.spine.model|string is search('7280.*') %}
{% set lc_start = 3 %}
{% set lc_end   = 4 %}
{% endif %}
{% if hec.spine.model|string is search('.*-.*') %}
{% set ports_per_lc = hec.spine.model|string %}
{% set ports_per_lc = ports_per_lc|regex_replace('^.*-(?P<num>[1-9][0-9])$', '\\g<num>') %}
{% endif %}
{% set create_ip_on_interface = "yes" %}
{% set port_range_end = ports_per_lc|int + 1 %}
! DEBUG: port_range_end {{port_range_end}}
{% include "templates/config_templates/sw-hec-spine-ips.j2" %}
!
interface Loopback1
   description Router-ID
   ip address 10.100.0.{{ item.id }}/32
!
interface Loopback900
   description NW-MGMT
   ip address {{ hec.lo900_prefix }}.{{ item.id }}/32
!
interface {{oob_mgmt_intf}}
   description OOB MGMT
   vrf forwarding OOB
   ip address {{ hec.oob_prefix }}.{{ item.id }}/{{ hec.oob_mask }}
!
router bgp 641{{ hec.hec_nr }}.10000
   router-id 10.100.0.{{ item.id }}
   bgp listen range 10.{{ item.id }}.0.0/16 peer-group LEAF-PG peer-filter LEAF-PF
   network 10.100.0.{{ item.id }}/32
   network {{ hec.lo900_prefix }}.{{ item.id }}/32
!
