{########## INTERFACE CONFIGURATION WHICH IS SPECIFIC TO SPINES ##########}
{% if hec.spine.model|string == '7504' or hec.spine.model|string == '7508'  %}
{% set lc_start = 3 %}
{% set lc_end   = lc_start + hec.spine.linecards %}
{% endif %}
{% if hec.spine.model|string == '7280' %}
{% set lc_start = 3 %}
{% set lc_end   = 4 %}
{% endif %}
{% set create_ip_on_interface = "no" %}
{% include "templates/config_templates/sw-hec-spine-ips.j2" %}
{########## BGP CONFIGURATION ##########}
peer-filter EVPN-PF
! ##### {{ hec.as_low }}-{{ hec.as_high }} == 641{{ hec.hec_nr }}.10001-641{{ hec.hec_nr }}.11199 #####
   10 match as-range {{ hec.as_low }}-{{ hec.as_high }} result accept
!
peer-filter LEAF-PF
! ##### {{ hec.as_low }}-{{ hec.as_high }} == 641{{ hec.hec_nr }}.10001-641{{ hec.hec_nr }}.11199 #####
   10 match as-range {{ hec.as_low }}-{{ hec.as_high }} result accept
!
router bgp 641{{ hec.hec_nr }}.10000
   bgp asn notation asdot
   maximum-paths 8 ecmp 16
{% if hec.fabric.vtep_distribution_mode == "evpn" %}
{% for listen_range in hec.fabric.bgp_listen_ranges %}
   bgp listen range {{ listen_range }} peer-group EVPN-PG peer-filter EVPN-PF
{% endfor %}
   neighbor EVPN-PG peer-group
   neighbor EVPN-PG update-source Loopback1
   neighbor EVPN-PG fall-over bfd
   neighbor EVPN-PG ebgp-multihop 2
   neighbor EVPN-PG send-community standard extended
   neighbor EVPN-PG maximum-routes 0
{% endif %}
!
   neighbor LEAF-PG peer-group
   neighbor LEAF-PG send-community
{% if hec.spine.underlay_bfd is defined %}
{% if hec.spine.underlay_bfd == "enable" %}
   neighbor LEAF-PG fall-over bfd
{% endif %}
{% endif %}
   neighbor LEAF-PG soft-reconfiguration inbound all
   neighbor LEAF-PG maximum-routes {{ hec.fabric.bgp_maximum_routes }}
!
{% if hec.fabric.vtep_distribution_mode == "evpn" %}
   address-family evpn
      bgp next-hop-unchanged
      neighbor EVPN-PG activate
   !
{% endif %}
   address-family ipv4
{% if hec.fabric.vtep_distribution_mode == "evpn" %}
      no neighbor EVPN-PG activate
{% endif %}
      neighbor LEAF-PG activate
!
{########## SPINE MAINTENANCE CONFIGURATION ##########}
group interface FABRIC
{% if hec.spine.model|string == '7504' or hec.spine.model|string == '7508'  %}
   interface Et{% for lc in range(lc_start, lc_end) %}{% for subintf in range(1,37) %}{{ lc }}/{{ subintf }}/1{% if not ( lc == lc_end-1 and subintf == 36 ) %},{% endif %}{% endfor %}{% endfor %}

{% endif %}
{% if hec.spine.model|string == '7280'  %}
   interface Et{% for subintf in range(1,37) %}{{ subintf }}/1{% if not ( subintf == 36 ) %},{% endif %}{% endfor %}

{% endif %}
   exit
!
maintenance
   unit QUAY
      group interface FABRIC
      group bgp ALL-LEAF
    exit
  exit
!
! ============= to enable a port, add it to the list of interfaces below =============
!
! ============= to enable a port, add it to the list of interfaces below =============

!

interface {% if hec.l2l3_leaf is defined %}{% for l2l3 in hec.l2l3_leaf %}{{ l2l3.spine_port_towards_leaf }}{% if not loop.last %}, {% else %}{% if hec.brdr is defined %}, {% endif %}{% endif %}{% endfor %}{% endif %}{% if hec.brdr is defined %}{% for brdr in hec.brdr %}{{ brdr.spine_port_towards_leaf }}{% if not loop.last %}, {% else %}{% if hec.str is defined %}, {% endif %}{% endif %}{% endfor %}{% endif %}{% if hec.str is defined %}{% for str in hec.str %}{{ str.spine_port_towards_leaf }}{% if not loop.last %}, {% else %}{% if hec.shs is defined %}, {% endif %}{% endif %}{% endfor %}{% endif %}{% if hec.shs is defined %}{% for shs in hec.shs %}{{ shs.spine_port_towards_leaf }}{% if not loop.last %}, {% else %}{% if hec.ngdr is defined %}, {% endif %}{% endif %}{% endfor %}{% endif %}{% if hec.ngdr is defined %}{% for ngdr in hec.ngdr %}{{ ngdr.spine_port_towards_leaf }}{% if not loop.last %}, {% endif %}{% endfor %}{% endif %}

 no shutdown
